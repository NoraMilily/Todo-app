================================================================================
                    TODO APP - Руководство по установке и запуску
================================================================================

Описание проекта:
-----------------
Todo App - это веб-приложение для управления задачами (todo list) с
авторизацией пользователей, профилями и поддержкой нескольких языков.

Технологии:
- Next.js 16 (React 19)
- TypeScript
- PostgreSQL (база данных)
- Prisma ORM
- NextAuth (аутентификация)
- Tailwind CSS

================================================================================
                          ТРЕБОВАНИЯ К СИСТЕМЕ
================================================================================

Для запуска проекта необходимо установить:

1. Node.js версии 18.17 или выше
   Скачать: https://nodejs.org/
   Проверить версию: node --version

2. npm (устанавливается вместе с Node.js)
   Проверить версию: npm --version

3. Docker и Docker Compose (для запуска PostgreSQL)
   Скачать: https://www.docker.com/get-started
   Проверить: docker --version
              docker-compose --version

   АЛЬТЕРНАТИВА: Если у вас уже установлен PostgreSQL локально,
   можете использовать его вместо Docker.

4. Git (для клонирования репозитория)
   Скачать: https://git-scm.com/

================================================================================
                    ПОШАГОВАЯ ИНСТРУКЦИЯ ПО УСТАНОВКЕ
================================================================================

ШАГ 1: Клонирование проекта
-----------------------------
Если проект находится в Git репозитории:
    git clone <URL_репозитория>
    cd todo-app

Если у вас уже есть папка с проектом, просто откройте её в терминале.


ШАГ 2: Установка зависимостей
-------------------------------
Откройте терминал в папке проекта и выполните:

    npm install

Это установит все необходимые пакеты из package.json.
Процесс может занять 2-5 минут в зависимости от скорости интернета.

Ожидаемый результат: создастся папка node_modules/ с установленными пакетами.


ШАГ 3: Настройка базы данных (PostgreSQL)
------------------------------------------

ВАРИАНТ A: Использование Docker (рекомендуется)
------------------------------------------------
1. Запустите PostgreSQL через Docker Compose:

    docker-compose up -d

   Это создаст и запустит контейнер с PostgreSQL на порту 5432.

2. Проверьте, что контейнер запущен:

    docker ps

   Вы должны увидеть контейнер с именем "todo_app_postgres".


ВАРИАНТ B: Использование локального PostgreSQL
------------------------------------------------
Если у вас уже установлен PostgreSQL:

1. Создайте базу данных:

   Откройте psql или любой клиент PostgreSQL и выполните:

   CREATE DATABASE todo_db;

   Или через командную строку:
   createdb todo_db

2. Убедитесь, что PostgreSQL запущен и доступен на порту 5432.


ШАГ 4: Настройка переменных окружения
--------------------------------------
1. Создайте файл .env в корне проекта.

2. Создайте файл со следующим содержимым:

   DATABASE_URL="postgresql://postgres:postgres@localhost:5432/todo_db?schema=public"

   AUTH_SECRET="ваш-секретный-ключ-для-nextauth-минимум-32-символа"

   AUTH_URL="http://localhost:3000"

   ПРИМЕЧАНИЯ:
   - Если используете локальный PostgreSQL, измените DATABASE_URL:
     DATABASE_URL="postgresql://ваш_пользователь:ваш_пароль@localhost:5432/todo_db?schema=public"

   - Для AUTH_SECRET сгенерируйте случайную строку (минимум 32 символа).
     Выполните в терминале:

     node -e "console.log(require('crypto').randomBytes(32).toString('hex'))"

     Скопируйте полученную строку и вставьте в AUTH_SECRET.

     Или используйте команду NextAuth:
     npx auth secret

   - AUTH_URL должен соответствовать URL, на котором запущено приложение.
     Для разработки обычно: http://localhost:3000


ШАГ 5: Настройка Prisma
------------------------
1. Сгенерируйте Prisma Client:

    npm run prisma:generate

   Это создаст типизированный клиент для работы с базой данных.

2. Примените миграции базы данных:

    npm run prisma:migrate

   Это создаст все необходимые таблицы в базе данных (User, Todo).

   Если появится запрос на имя миграции, введите любое имя, например: "init"


ШАГ 6: Запуск приложения
-------------------------
1. Запустите сервер разработки:

    npm run dev

2. Откройте браузер и перейдите по адресу:

    http://localhost:3000

   Или для русского языка:
    http://localhost:3000/ru

   Или для английского:
    http://localhost:3000/en


================================================================================
                          ИСПОЛЬЗОВАНИЕ ПРИЛОЖЕНИЯ
================================================================================

Первое использование:
---------------------
1. Зарегистрируйте нового пользователя:
   - Перейдите на страницу регистрации (/ru/auth/register)
   - Введите email, username и пароль
   - Нажмите "Зарегистрироваться"

2. Войдите в систему:
   - Перейдите на страницу входа (/ru/auth/login)
   - Введите email или username и пароль
   - Нажмите "Войти"

3. Используйте приложение:
   - Добавляйте задачи на главной странице
   - Редактируйте профиль в разделе "Профиль"
   - Фильтруйте задачи по статусу (Все/Активные/Выполненные)


================================================================================
                      ПОЛЕЗНЫЕ КОМАНДЫ
================================================================================

Разработка:
-----------
npm run dev              - Запустить сервер разработки
npm run build            - Собрать проект для production
npm run start            - Запустить production версию
npm run lint             - Проверить код на ошибки

База данных:
------------
npm run prisma:generate  - Сгенерировать Prisma Client
npm run prisma:migrate   - Применить миграции
npm run prisma:studio    - Открыть Prisma Studio (GUI для БД)

Docker:
-------
docker-compose up -d     - Запустить PostgreSQL
docker-compose down      - Остановить PostgreSQL
docker-compose logs      - Посмотреть логи
docker ps                - Показать запущенные контейнеры


================================================================================
                      ВОЗМОЖНЫЕ ПРОБЛЕМЫ И РЕШЕНИЯ
================================================================================

ПРОБЛЕМА: "Cannot find module '@prisma/client'"
РЕШЕНИЕ: Выполните: npm run prisma:generate

ПРОБЛЕМА: "Error: P1001: Can't reach database server"
РЕШЕНИЕ:
  1. Проверьте, что PostgreSQL запущен (docker-compose up -d)
  2. Проверьте DATABASE_URL в файле .env
  3. Убедитесь, что порт 5432 не занят другим приложением

ПРОБЛЕМА: "Port 3000 is already in use"
РЕШЕНИЕ:
  1. Остановите другое приложение на порту 3000
  2. Или измените порт: PORT=3001 npm run dev

ПРОБЛЕМА: "Migration failed"
РЕШЕНИЕ:
  1. Убедитесь, что база данных создана
  2. Проверьте права доступа к базе данных
  3. Попробуйте сбросить миграции:
     npx prisma migrate reset (ОСТОРОЖНО: удалит все данные!)

ПРОБЛЕМА: "Module not found" или ошибки импорта
РЕШЕНИЕ:
  1. Удалите папку node_modules
  2. Удалите package-lock.json
  3. Выполните: npm install

ПРОБЛЕМА: Docker не запускается
РЕШЕНИЕ:
  1. Убедитесь, что Docker Desktop запущен
  2. Проверьте, что порт 5432 свободен
  3. Попробуйте изменить порт в docker-compose.yml


================================================================================
                      СТРУКТУРА ПРОЕКТА
================================================================================

Основные папки и файлы:

src/
  app/              - Страницы и маршруты Next.js
    [locale]/      - Страницы с поддержкой языков - маршрутизатор сайта
    actions/       - Server Actions (серверная логика)
    api/           - API маршруты
  components/      - React компоненты
  lib/             - Вспомогательные библиотеки
  i18n/            - Настройки интернационализации

prisma/
  schema.prisma    - Схема базы данных
  migrations/      - Миграции базы данных

public/
  avatars/         - Загруженные аватары пользователей

messages/
  ru.json          - Русские переводы
  en.json          - Английские переводы


================================================================================
                      ДОПОЛНИТЕЛЬНАЯ ИНФОРМАЦИЯ
================================================================================

Документация проекта:
---------------------
- FRONTEND_BACKEND_EXPLANATION.md - Объяснение архитектуры
- TECHNICAL_DETAILS.md - Технические детали
- REFERENCES.md - Список литературы
- TECHNOLOGY_JUSTIFICATION.md - Обоснование выбора технологий

Полезные ссылки:
----------------
- Next.js: https://nextjs.org/docs
- Prisma: https://www.prisma.io/docs
- NextAuth: https://next-auth.js.org
- React: https://react.dev


================================================================================
                      ПОДДЕРЖКА И ВОПРОСЫ
================================================================================

Если у вас возникли проблемы:
1. Проверьте, что все зависимости установлены (npm install)
2. Убедитесь, что база данных запущена
3. Проверьте файл .env на наличие всех необходимых переменных
4. Посмотрите логи в терминале для диагностики ошибок

Для просмотра базы данных:
- Запустите: npm run prisma:studio
- Откроется веб-интерфейс для просмотра и редактирования данных


================================================================================
              ЗАПУСК ПРОЕКТА В PRODUCTION РЕЖИМЕ С NGINX
================================================================================

Этот раздел описывает, как запустить приложение в production режиме
с использованием Nginx в качестве reverse proxy.

ТРЕБОВАНИЯ:
-----------
- Установленный Nginx
- Собранное production приложение
- Запущенная база данных PostgreSQL


ШАГ 1: Подготовка production сборки
-------------------------------------
1. Убедитесь, что все зависимости установлены:

    npm install

2. Сгенерируйте Prisma Client:

    npm run prisma:generate

3. Соберите production версию приложения:

    npm run build

   Это создаст оптимизированную версию приложения в папке .next/


ШАГ 2: Настройка переменных окружения для production
-----------------------------------------------------
Создайте или обновите файл .env с production настройками:

    DATABASE_URL="postgresql://postgres:postgres@localhost:5432/todo_db?schema=public"
    AUTH_SECRET="ваш-секретный-ключ-минимум-32-символа"
    AUTH_URL="http://ваш-домен.com"  # Или http://localhost для тестирования
    NODE_ENV="production"


ШАГ 3: Установка и настройка Nginx
-----------------------------------

ВАРИАНТ A: Linux (Ubuntu/Debian)
---------------------------------
1. Установите Nginx (если не установлен):

    sudo apt update
    sudo apt install nginx

2. Скопируйте конфигурацию nginx.conf в папку sites-available:

    sudo cp nginx.conf /etc/nginx/sites-available/todo-app

3. Отредактируйте конфигурацию:

    sudo nano /etc/nginx/sites-available/todo-app

   Измените:
   - server_name на ваш домен (или оставьте localhost)
   - proxy_pass на порт, где будет работать Next.js (по умолчанию 3000)

4. Создайте символическую ссылку:

    sudo ln -s /etc/nginx/sites-available/todo-app /etc/nginx/sites-enabled/

5. Проверьте конфигурацию Nginx:

    sudo nginx -t

6. Перезапустите Nginx:

    sudo systemctl restart nginx


ВАРИАНТ B: Windows
------------------
1. Скачайте Nginx: http://nginx.org/en/download.html

2. Распакуйте архив (например, в C:\nginx)

3. Скопируйте nginx.conf в папку conf (C:\nginx\conf\todo-app.conf)

4. Откройте C:\nginx\conf\nginx.conf и добавьте в конец:

    include todo-app.conf;

5. Запустите Nginx:

    cd C:\nginx
    start nginx

   Или через командную строку от администратора:
   nginx.exe


ШАГ 4: Запуск Next.js приложения
---------------------------------

ВАРИАНТ A: Прямой запуск (для тестирования)
--------------------------------------------
1. Запустите production сервер:

    npm start

   Приложение будет доступно на http://localhost:3000

2. Nginx будет проксировать запросы с порта 80 на порт 3000


ВАРИАНТ B: Использование PM2 (рекомендуется для production)
-----------------------------------------------------------
PM2 - это менеджер процессов для Node.js приложений.

1. Установите PM2 глобально:

    npm install -g pm2

2. Создайте папку для логов:

    mkdir logs

3. Запустите приложение через PM2:

    pm2 start ecosystem.config.js

4. Сохраните конфигурацию PM2 (чтобы приложение запускалось после перезагрузки):

    pm2 save
    pm2 startup

5. Полезные команды PM2:

    pm2 list              - Список запущенных приложений
    pm2 logs todo-app     - Просмотр логов
    pm2 restart todo-app   - Перезапуск приложения
    pm2 stop todo-app      - Остановка приложения
    pm2 delete todo-app    - Удаление из PM2


ШАГ 5: Проверка работы
-----------------------
1. Убедитесь, что Next.js приложение запущено:

    # Если используете PM2:
    pm2 list

    # Если запускали напрямую:
    # Проверьте, что процесс работает на порту 3000

2. Проверьте, что Nginx запущен:

    # Linux:
    sudo systemctl status nginx

    # Windows:
    # Проверьте процессы в диспетчере задач

3. Откройте браузер и перейдите:

    http://localhost        # Если используете Nginx на порту 80
    http://localhost:3000   # Если обращаетесь напрямую к Next.js

4. Проверьте логи при ошибках:

    # Логи Nginx:
    sudo tail -f /var/log/nginx/todo-app-error.log

    # Логи PM2:
    pm2 logs todo-app


ШАГ 6: Настройка HTTPS (опционально, для production)
------------------------------------------------------
Для production рекомендуется использовать HTTPS.

1. Получите SSL сертификат (например, через Let's Encrypt):

    sudo apt install certbot python3-certbot-nginx
    sudo certbot --nginx -d ваш-домен.com

2. Или используйте самоподписанный сертификат для тестирования:

    # Создайте сертификат
    openssl req -x509 -nodes -days 365 -newkey rsa:2048 \
      -keyout /etc/nginx/ssl/nginx.key \
      -out /etc/nginx/ssl/nginx.crt

3. Раскомментируйте секцию HTTPS в nginx.conf и укажите пути к сертификатам


ОСОБЕННОСТИ КОНФИГУРАЦИИ NGINX:
--------------------------------
- proxy_pass http://localhost:3000 - проксирует запросы к Next.js
- client_max_body_size 2M - максимальный размер загружаемых файлов (аватары)
- proxy_set_header - передает правильные заголовки для Next.js
- Кэширование статических файлов для лучшей производительности


РЕШЕНИЕ ПРОБЛЕМ С NGINX:
------------------------
ПРОБЛЕМА: "502 Bad Gateway"
РЕШЕНИЕ:
  1. Проверьте, что Next.js приложение запущено (pm2 list или проверка порта 3000)
  2. Проверьте, что в nginx.conf указан правильный порт (proxy_pass)
  3. Проверьте логи: sudo tail -f /var/log/nginx/todo-app-error.log

ПРОБЛЕМА: "Connection refused"
РЕШЕНИЕ:
  1. Убедитесь, что приложение слушает на порту 3000
  2. Проверьте файрвол (должен разрешать подключения к порту 3000)
  3. Проверьте, что AUTH_URL в .env соответствует URL, на котором доступно приложение

ПРОБЛЕМА: Статические файлы не загружаются
РЕШЕНИЕ:
  1. Проверьте права доступа к папке public/
  2. Убедитесь, что Next.js правильно собрался (npm run build)
  3. Проверьте конфигурацию location /_next/static в nginx.conf


АЛЬТЕРНАТИВНЫЙ ВАРИАНТ: Запуск без Nginx
-----------------------------------------
Если не хотите использовать Nginx, можно запустить Next.js напрямую:

1. Соберите приложение: npm run build
2. Запустите: npm start
3. Приложение будет доступно на http://localhost:3000

НО: Для production рекомендуется использовать Nginx или другой reverse proxy
для:
- Обработки статических файлов
- SSL/TLS терминации
- Балансировки нагрузки
- Сжатия ответов


================================================================================
                            УДАЧИ!
================================================================================

Если всё настроено правильно, вы должны увидеть рабочее приложение
на http://localhost:3000 (или через Nginx на http://localhost)

Приятной работы с проектом!
